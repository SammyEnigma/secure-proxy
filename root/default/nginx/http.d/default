
# redirect traffic to https
server {
    listen 80 default_server;
    listen [::]:80 default_server;
	server_name _;
    location / {
        return 301 https://$host$request_uri;
    }
}

# Default SSL server
server {
    listen 443 ssl http2 default_server;
    listen [::]:443 ssl http2 default_server;

	root /config/www;
	index index.html;

	# include ssl related config
	include /config/nginx/ssl.conf;

	# Include subfolder reverse proxy confs
	include /config/nginx/proxy.d/*.subfolder.conf;

	# Default location in case no location is specified
	location / {
		try_files $uri $uri/ /index.html =404;
	}

	# Error location block
	location = /error.html {
		ssi on;
		internal;
		auth_basic off;
		root /config/www;
	}
}

# Include custom subdomain proxy pages
include /config/nginx/proxy.d/*.subdomain.conf;

# enable proxy cache for auth
proxy_cache_path cache/ keys_zone=auth_cache:10m;